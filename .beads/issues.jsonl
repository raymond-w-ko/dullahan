{"id":"du-0a7","title":"Implement Primary Device Attribute (DA1) response","description":"Fish shell shows warning on startup:\n\n```\nwarning: fish could not read response to Primary Device Attribute query after waiting for 2 seconds.\nThis is often due to a missing feature in your terminal.\nSee 'help terminal-compatibility' or 'man fish-terminal-compatibility'.\nThis fish process will no longer wait for outstanding queries, which disables some optional features.\n```\n\nNeed to implement DA1 response in the terminal emulator.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T15:55:11.517628Z","created_by":"rko","updated_at":"2025-12-31T15:58:11.804762Z","closed_at":"2025-12-31T15:58:11.804762Z","close_reason":"Implemented DA1/DA2 response in pane.zig. Terminal now responds to CSI c with VT220+color capabilities.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-12r","title":"Implement window-padding options","description":"Add padding around terminal content.\nOptions: window-padding-x = 6, window-padding-y = 6\nDifficulty: Simple - CSS padding on terminal container","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:43:08.903285680Z","created_by":"rko","updated_at":"2025-12-30T16:41:31.519676Z","closed_at":"2025-12-30T16:41:31.519676Z","close_reason":"Removed - terminal padding now controlled by spacing mode (--space-2 CSS variable)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-12r","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-14t","title":"Implement XTGETTCAP responses for common keys (indn, Ms, query-os-name)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T02:49:16.024170986Z","created_by":"rko","updated_at":"2026-01-30T02:53:07.037623814Z","closed_at":"2026-01-30T02:53:07.037611380Z","close_reason":"Done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-1i5","title":"Add resync message for cache miss recovery","description":"## Problem\n\nCommit 92eec66 added cache pruning to prevent unbounded memory growth (500 rows max, 256 styles max). However, after pruning, if a delta references evicted data, the client silently corrupts:\n\n- **Missing rows**: Fills with empty cells (spaces) — visible blank lines\n- **Missing styles**: Falls back to DEFAULT_STYLE — colors/attributes lost\n\nThe server has no way to detect this. The `minRowId` field in sync messages is parsed but never used.\n\n## Solution\n\nAdd a new `resync` message type that the client sends when it detects missing data.\n\n### Protocol Addition\n\n```json\n{ \"type\": \"resync\", \"paneId\": 1, \"reason\": \"cache_miss\" }\n```\n\nValid reasons: `cache_miss`, `style_miss`, `corruption`, `manual`\n\n### Files to Modify\n\n**Protocol:**\n- `protocol/schema/messages.ts` — Add ResyncMessage interface\n\n**Server:**\n- `server/src/messages.zig` — Add ParsedResync struct\n- `server/src/message_parsing.zig` — Add parser for resync message\n- `server/src/message_handlers.zig` — Add handleResync() that sends full snapshot\n\n**Client:**\n- `client/src/terminal/connection.ts`:\n  - Add `requestResync(paneId, reason)` method with 1-second debounce\n  - In `applyDelta()`, detect missing rows (line ~1059) and call requestResync\n  - Add style miss detection after style merging\n  - Track resync counts in pane state for debug UI\n\n### Detection Logic\n\n```typescript\n// Row miss detection (threshold: 10% of rows or minimum 3)\nconst missingRowThreshold = Math.max(3, Math.floor(delta.rows * 0.1));\nif (notInCache.length > missingRowThreshold) {\n  this.requestResync(paneId, \"cache_miss\");\n  return; // Don't emit corrupted snapshot\n}\n\n// Style miss detection\nfor (const cell of cells) {\n  if (cell.styleId !== 0 && !styles.has(cell.styleId)) {\n    this.requestResync(paneId, \"style_miss\");\n    return;\n  }\n}\n```\n\n### Debounce Implementation\n\n```typescript\nprivate _lastResyncTime: Map<number, number> = new Map();\nprivate readonly RESYNC_COOLDOWN_MS = 1000;\n\nrequestResync(paneId: number, reason: string): void {\n  const now = Date.now();\n  const lastResync = this._lastResyncTime.get(paneId) ?? 0;\n  if (now - lastResync < this.RESYNC_COOLDOWN_MS) return;\n  \n  this._lastResyncTime.set(paneId, now);\n  this.send({ type: \"resync\", paneId, reason });\n}\n```\n\n## Acceptance Criteria\n\n1. Client detects when delta references rows not in cache\n2. Client detects when cells reference styles not in table\n3. Client sends resync message (debounced)\n4. Server responds with full snapshot\n5. No visible corruption after cache pruning\n\n## Reference\n\nDesign doc: `docs/cache-miss-resync-design.md`\nRelated commit: 92eec66 (cache pruning)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-26T20:08:58.409424613Z","created_by":"rko","updated_at":"2026-01-26T20:14:48.380538932Z","closed_at":"2026-01-26T20:14:48.380525753Z","close_reason":"Implemented resync message for cache miss recovery","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-1kg","title":"Validate TLS disconnect behavior with OpenSSL backend","description":"Goal: determine whether TLS disconnects (poll error/hangup) persist after OpenSSL swap.\n\nSteps:\n- Build with Zig 0.15.2 and OpenSSL backend (from du-341).\n- Reproduce original workload; compare HTTPS/WSS vs plain HTTP.\n- Enable DULLAHAN_DEBUG=+connection and add TLS read/write error logs in tls_wrapper to capture SSL errors (ERR_get_error) and map to disconnects.\n- Track occurrences of \"poll error/hangup\" and correlate with write congestion logs and client disconnects.\n\nAcceptance:\n- Clear yes/no on whether OpenSSL eliminates disconnects.\n- If still present, record most common SSL/errno path and propose next fix (timeouts, non-blocking handling, write buffering).","notes":"Initial validation after OpenSSL swap:\n- WSS/HTTPS handshakes complete in ~1–4ms; HTTP headers read in ~1–2ms.\n- No \"poll error/hangup\" disconnects observed in /tmp/dullahan-<uid>/dullahan.log for this session.\n- Connection delays traced to speculative TLS connections that never send HTTP (read timeouts at 250ms each) rather than TLS handshake cost.\n- Added timeout logging in server/src/http.zig to record accept/handshake timing and peer address.\n\nScope note: no long-duration soak test; reopen if disconnects reappear under load.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T22:39:23.363631355Z","created_by":"rko","updated_at":"2026-01-28T23:28:26.552775110Z","closed_at":"2026-01-28T23:28:26.552727731Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-1m3","title":"Delta Sync Phase 3: Optimization","description":"Optimize delta sync for bandwidth and performance. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-01T15:38:58.692785Z","created_by":"rko","updated_at":"2026-01-01T16:32:24.877251Z","closed_at":"2026-01-01T16:32:24.877251Z","close_reason":"All Phase 3 tasks complete (du-up7, du-msr, du-ipx deferred)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-1m3","depends_on_id":"du-1nr","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1m3","depends_on_id":"du-ipx","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1m3","depends_on_id":"du-msr","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1m3","depends_on_id":"du-up7","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-1nr","title":"Delta Sync Phase 2: Basic Deltas","description":"Implement basic delta sync protocol. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-01T15:38:53.150110Z","created_by":"rko","updated_at":"2026-01-01T16:03:31.201891Z","closed_at":"2026-01-01T16:03:31.201891Z","close_reason":"All Phase 2 tasks complete (du-lvb, du-4ro, du-pxn)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-1nr","depends_on_id":"du-4ro","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1nr","depends_on_id":"du-gbq","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1nr","depends_on_id":"du-lvb","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-1nr","depends_on_id":"du-pxn","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-1p3","title":"Remove deprecated log_config.zig after migration","description":"After migration to category logging is complete:\n\n1. Delete server/src/log_config.zig (32 lines, 9 boolean consts)\n2. Update any remaining references\n3. Update AGENTS.md to document new server-side category logging system\n4. Add server logging section similar to existing 'Client Debug Logging' section\n\nDepends on migration being complete.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-25T07:00:11.162466103Z","created_by":"rko","updated_at":"2026-01-25T22:10:16.736267583Z","closed_at":"2026-01-25T22:10:16.736256552Z","close_reason":"Implemented in commit 8819165","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-1p3","depends_on_id":"du-3pf","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-1tn","title":"Implement SIGINT handler for clean server shutdown","description":"Add Ctrl+C handler that cleanly disconnects clients, kills child processes, and exits. Currently Ctrl+C hangs when a terminal is running with a client connected.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T22:15:00.494510Z","created_by":"rko","updated_at":"2026-01-03T22:19:46.872623Z","closed_at":"2026-01-03T22:19:46.872623Z","close_reason":"Implemented SIGINT/SIGTERM handlers with atomic shutdown flag and poll-based IPC accept","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-21e","title":"Handle OSC 7 report PWD (optional forwarding/logging)","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-30T02:49:24.219194509Z","created_by":"rko","updated_at":"2026-01-30T03:26:30.035394356Z","closed_at":"2026-01-30T03:26:30.035381836Z","close_reason":"Done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-223","title":"Refactor ws_server.zig to use std.json for message parsing","description":"Replace manual JSON parsing in ws_server.zig with std.json.parseFromSlice.\n\n**Current approach (fragile):**\n- extractJsonString() - manual string search\n- extractJsonInt() - manual int parsing  \n- mem.indexOf for booleans like \"ctrl\":true\n\n**Message types to convert:**\n\n1. **KeyEvent** (lines 217-246):\n   - key, code, state, ctrl, alt, shift, meta, repeat, timestamp, keyCode\n\n2. **TextMessage** (line 178):\n   - type, data\n\n3. **ResizeMessage** (lines 193-194):\n   - type, cols, rows\n\n**Benefits:**\n- Type-safe field access\n- Automatic JSON escape handling\n- Default values for optional fields\n- Catches malformed JSON early\n- Removes ~80 lines of manual parsing code\n\n**Implementation:**\n```zig\nconst KeyEvent = struct {\n    type: []const u8,\n    key: []const u8,\n    code: []const u8,\n    state: []const u8,\n    ctrl: bool = false,\n    alt: bool = false,\n    shift: bool = false,\n    meta: bool = false,\n    repeat: bool = false,\n    timestamp: f64 = 0,\n    keyCode: u16 = 0,\n};\n\nconst parsed = try std.json.parseFromSlice(KeyEvent, allocator, json, .{\n    .ignore_unknown_fields = true,\n});\ndefer parsed.deinit();\n```\n\nNote: Requires passing allocator to keyEventToBytes()","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:33:16.290712Z","created_by":"rko","updated_at":"2025-12-31T17:40:31.442644Z","closed_at":"2025-12-31T17:40:31.442644Z","close_reason":"Implemented in commit bbb453f","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-279","title":"Create Wine-style category debug logging for server","description":"Create a unified Wine-style category-based debug logging system for the server, mirroring the client's debug.ts implementation.\n\nNew files:\n- server/src/debug_config.zig - Parse Wine-style config strings (+all,-delta,+clipboard)\n- server/src/debug_logger.zig - Category-scoped logger factory\n\nCategories (17 total):\nconnection, keyboard, mouse, clipboard, pane, window, delta, snapshot, layout, theme, pty, ics, dsr, ipc, http, signal, perf\n\nFeatures:\n- Runtime configuration (not compile-time)\n- Parse syntax: +category enables, -category disables, +all/-all wildcards\n- Left-to-right evaluation\n- Errors always log regardless of category setting\n- Output to 3 channels: log file, debug pane, stderr\n\nReference: client/src/debug.ts (274 lines, complete implementation)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T07:00:07.978980138Z","created_by":"rko","updated_at":"2026-01-25T22:08:53.778567729Z","closed_at":"2026-01-25T22:08:53.778557464Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2ap","title":"Rewrite debug.ts with category parsing","description":"Rewrite client/src/debug.ts to support Wine-style category-based logging.\n\n## Changes needed\n\n### 1. Parse debug string\n```typescript\nfunction parseDebugConfig(value: string): { enabledCategories: Set<string>, disabledCategories: Set<string>, allEnabled: boolean } {\n  // Parse \"+all,-mouse,+pane\" format\n  // Handle bare \"true\" for backward compat\n}\n```\n\n### 2. Track category state\n```typescript\nlet enabledCategories = new Set<string>();\nlet disabledCategories = new Set<string>();\nlet allEnabled = false;\n\nfunction isCategoryEnabled(category: string): boolean {\n  if (disabledCategories.has(category)) return false;\n  if (enabledCategories.has(category)) return true;\n  return allEnabled;\n}\n```\n\n### 3. Category-scoped logger factory\n```typescript\nexport function category(name: string) {\n  return {\n    log: (...args: unknown[]) => {\n      if (isCategoryEnabled(name)) console.log(`[dullahan:${name}]`, ...args);\n    },\n    warn: (...args: unknown[]) => {\n      if (isCategoryEnabled(name)) console.warn(`[dullahan:${name}]`, ...args);\n    },\n    error: (...args: unknown[]) => {\n      // Always log errors\n      console.error(`[dullahan:${name}]`, ...args);\n    },\n  };\n}\n```\n\n### 4. Backward compatibility\n- `?debug` (no value) → `+all`\n- `?debug=true` → `+all`\n- Keep existing `debug.log()` working (treat as uncategorized or 'misc')\n\n### 5. Runtime API\n```typescript\nexport function setCategories(config: string): void;\nexport function getCategories(): string;\nexport function listCategories(): string[]; // List all known categories\n```\n\n## Testing\n- `?debug=+all` - everything logs\n- `?debug=+mouse` - only mouse logs\n- `?debug=+all,-mouse` - everything except mouse\n- `?debug=-all,+mouse,+keyboard` - only mouse and keyboard\n- `?debug` - backward compat, enables all","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T06:01:50.599597905Z","created_by":"rko","updated_at":"2026-01-25T06:06:30.030718112Z","closed_at":"2026-01-25T06:06:30.030706036Z","close_reason":"Implemented Wine-style category debug logging","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2bx","title":"Extract layout helpers to layout_helpers.zig","description":"## Overview\nExtract layout parsing and validation helpers from `server/src/event_loop.zig` into a new file `server/src/layout_helpers.zig`.\n\n## Why\nThe event_loop.zig file is ~2784 lines. Layout helpers are self-contained utilities that don't need EventLoop context.\n\n## What to Extract\nLines 913-1089 of event_loop.zig contain layout helpers:\n\n### Types\n```zig\nconst LayoutNode = layout_db.LayoutNode;\n\nconst LayoutParseError = error{\n    InvalidLayoutNodes,\n    InvalidLayoutNode,\n    MissingType,\n    InvalidType,\n    MissingWidth,\n    MissingHeight,\n    InvalidWidth,\n    InvalidHeight,\n    MissingChildren,\n    InvalidNodeType,\n    OutOfMemory,\n};\n```\n\n### Functions to Extract\n```zig\nfn parseLayoutNodesFromJson(allocator, json_nodes: std.json.Value) LayoutParseError![]LayoutNode\nfn parseLayoutNodeFromJson(allocator, json_node: std.json.Value) LayoutParseError!LayoutNode\nfn freeLayoutNodes(allocator, nodes: []LayoutNode) void\nfn validateLayoutPercentages(nodes: []const LayoutNode) bool\nfn validateLayoutPercentagesImpl(nodes: []const LayoutNode) bool\nfn copyLayoutDimensions(old_nodes: []LayoutNode, new_nodes: []const LayoutNode) !void\nfn copyLayoutDimensionsStatic(old_nodes: []LayoutNode, new_nodes: []const LayoutNode) !void\n```\n\n### Also Extract (from lines 62-89)\n```zig\nfn logLayoutDimensions(nodes: []const layout_db.LayoutNode, indent: usize) void\nfn indentStr(indent: usize) []const u8\n```\n\n## Implementation Steps\n1. Create `server/src/layout_helpers.zig`\n2. Move all layout parsing types and functions\n3. Convert from methods to standalone functions (take `allocator` as first param)\n4. Add required imports: `std`, `layout_db`\n5. Make functions `pub` as needed\n6. In `event_loop.zig`, add: `const layout_helpers = @import(\"layout_helpers.zig\");`\n7. Update call sites: `self.parseLayoutNodesFromJson(...)` → `layout_helpers.parseLayoutNodesFromJson(self.allocator, ...)`\n8. Run `zig build` and `zig build test`\n\n## Alternative\nCould merge into existing `layout_db.zig` instead of creating new file. Decide based on cohesion.\n\n## Acceptance Criteria\n- [ ] New file `server/src/layout_helpers.zig` exists (or merged into layout_db.zig)\n- [ ] All layout parsing functions work from new location\n- [ ] `event_loop.zig` imports and uses the extracted module\n- [ ] `zig build` succeeds\n- [ ] `zig build test` passes\n- [ ] No functionality changes\n\n## Estimated Size\n~200 lines in new file","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T22:15:35.024103017Z","created_by":"rko","updated_at":"2026-01-25T22:31:46.201021165Z","closed_at":"2026-01-25T22:31:46.200986788Z","close_reason":"Extracted layout helpers to layout_helpers.zig (288 lines removed from event_loop.zig)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2ci","title":"Extract message parsing to message_parsing.zig","description":"## Overview\nExtract JSON and msgpack message parsing from `server/src/event_loop.zig` into a new file `server/src/message_parsing.zig`.\n\n## Why\nThe event_loop.zig file is ~2784 lines. Message parsing is protocol-specific logic that is self-contained and doesn't need EventLoop state.\n\n## What to Extract\nLines 1418-1847 of event_loop.zig contain two large parsing functions:\n\n### parseJsonMessage (~240 lines, 1418-1660)\n```zig\nfn parseJsonMessage(allocator, data: []const u8) ?struct { msg: ParsedMessage, cleanup: JsonCleanup }\n```\n\nHandles all message types:\n- key, text, resize, scroll, ping, sync, focus\n- hello, request_master, new_window, close_window, close_pane\n- set_layout, swap_panes, resize_layout\n- mouse, select_all, clear_selection\n- clipboard_response, clipboard_set, copy, clipboard_paste\n\n### parseMsgpackMessage (~185 lines, 1662-1847)\n```zig\nfn parseMsgpackMessage(allocator, data: []const u8) ?struct { msg: ParsedMessage, payload: msgpack.Payload }\n```\n\nHandles the same message types via msgpack protocol.\n\n## Implementation Steps\n1. Create `server/src/message_parsing.zig`\n2. Move both parsing functions\n3. Add required imports: `std`, `msgpack`, `messages`, `constants`\n4. Make functions `pub`:\n   ```zig\n   pub fn parseJsonMessage(allocator: std.mem.Allocator, data: []const u8) ?JsonParseResult\n   pub fn parseMsgpackMessage(allocator: std.mem.Allocator, data: []const u8) ?MsgpackParseResult\n   ```\n5. Define result types in new file:\n   ```zig\n   pub const JsonParseResult = struct { msg: messages.ParsedMessage, cleanup: messages.JsonCleanup };\n   pub const MsgpackParseResult = struct { msg: messages.ParsedMessage, payload: msgpack.Payload };\n   ```\n6. In `event_loop.zig`, add: `const message_parsing = @import(\"message_parsing.zig\");`\n7. Update call sites:\n   - `self.parseJsonMessage(...)` → `message_parsing.parseJsonMessage(self.allocator, ...)`\n   - `self.parseMsgpackMessage(...)` → `message_parsing.parseMsgpackMessage(self.allocator, ...)`\n8. Run `zig build` and `zig build test`\n\n## Dependencies\n- messages.zig (ParsedMessage, JsonCleanup, all message types)\n- constants.zig (buffer sizes)\n- msgpack library\n\n## Acceptance Criteria\n- [ ] New file `server/src/message_parsing.zig` exists\n- [ ] Both parsing functions work from new location\n- [ ] `event_loop.zig` imports and uses the extracted module\n- [ ] `zig build` succeeds\n- [ ] `zig build test` passes\n- [ ] Both JSON and msgpack message parsing work correctly\n\n## Estimated Size\n~450 lines in new file","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T22:15:52.029426979Z","created_by":"rko","updated_at":"2026-01-25T22:35:14.246572736Z","closed_at":"2026-01-25T22:35:14.246562261Z","close_reason":"Extracted message parsing to message_parsing.zig (430 lines removed from event_loop.zig)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2ex","title":"Server WS writes can block event loop; add send buffer","description":"Problem: sendBinary -> Stream.writeAll does synchronous writes on a single-threaded loop. With SO_SNDTIMEO=100ms, slow clients can stall the loop, and partial writes/timeouts can split frames (no per-client write buffer) leading to latency spikes or frame corruption.\\nEvidence: server/src/websocket.zig:205-208 uses writeAll; server/src/tls_wrapper.zig:155-162 loops until full write; server/src/event_loop.zig:483 sets 100ms timeouts and does not queue outbound data.\\nFix idea: switch to non-blocking sockets + per-client outbound queue (frame bytes). Track partial writes and resume on POLLOUT; avoid writeAll in hot path. This also lets you keep drop/slow-client policy explicit.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-28T05:50:02.017057154Z","created_by":"rko","updated_at":"2026-01-28T06:03:15.273751703Z","closed_at":"2026-01-28T06:03:15.273739759Z","close_reason":"Added WS write buffering and POLLOUT flush to avoid event loop stalls","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2g3","title":"Use minRowId for server-side cache staleness detection","description":"## Problem\n\nThe `minRowId` field exists in sync messages but is never used:\n\n```json\n{ \"type\": \"sync\", \"paneId\": 1, \"gen\": 500, \"minRowId\": 1000 }\n```\n\nIt's parsed in `message_parsing.zig:362` but ignored in `handleSync()`.\n\nThe server could use this to proactively detect when the client's cache is too stale and send a full snapshot without waiting for the client to notice missing rows.\n\n## Current Flow (Reactive)\n\n1. Client prunes old rows from cache\n2. Client sends sync with generation\n3. Server sends delta referencing old rows\n4. Client detects missing rows → requests resync (du-1i5)\n5. Server sends full snapshot\n\n## Proposed Flow (Proactive)\n\n1. Client prunes old rows from cache\n2. Client sends sync with generation AND minRowId (oldest cached row)\n3. Server compares minRowId with viewport's minimum row ID\n4. If client cache is too stale → send snapshot immediately\n5. Client receives full snapshot (no corruption, no round-trip for resync)\n\n## Implementation\n\n### Client Changes\n\nIn `connection.ts`, send actual minRowId in sync messages:\n\n```typescript\nsendSync(paneId: number): void {\n  const paneState = this._panes.get(paneId);\n  if (!paneState) return;\n  \n  // Find minimum row ID in cache\n  let minRowId = 0n;\n  for (const rowId of paneState.rowCache.keys()) {\n    if (minRowId === 0n || rowId < minRowId) {\n      minRowId = rowId;\n    }\n  }\n  \n  this.send({\n    type: \"sync\",\n    paneId,\n    gen: paneState.generation,\n    minRowId: Number(minRowId), // Convert bigint for JSON\n  });\n}\n```\n\n### Server Changes\n\nIn `message_handlers.zig`, pass minRowId to handleSyncRequest:\n\n```zig\nfn handleSync(el: *EventLoop, client: *ClientState, sync_msg: ParsedSync) !void {\n    const pane = el.session.activePane() orelse return;\n    try el.handleSyncRequest(client, pane, sync_msg.gen, sync_msg.minRowId);\n}\n```\n\nIn `event_loop.zig`, check if client cache is stale:\n\n```zig\npub fn handleSyncRequest(\n    self: *EventLoop,\n    client: *ClientState,\n    pane: *Pane,\n    client_gen: u64,\n    client_min_row_id: u64,\n) !void {\n    // Check if client's cache is too stale for current viewport\n    const viewport_min_row_id = pane.getMinVisibleRowId();\n    \n    if (client_min_row_id > viewport_min_row_id) {\n        // Client has evicted rows we need to reference\n        log.debug(\"Client cache stale: client_min={d} > viewport_min={d}\", .{\n            client_min_row_id, viewport_min_row_id,\n        });\n        const snap = try snapshot.generateBinarySnapshot(pane.allocator, pane);\n        defer pane.allocator.free(snap);\n        try client.ws.sendBinary(snap);\n        client.setGeneration(pane.id, pane.generation);\n        return;\n    }\n    \n    // ... existing delta logic\n}\n```\n\nNeed to add `getMinVisibleRowId()` to `pane.zig`:\n\n```zig\npub fn getMinVisibleRowId(self: *Pane) u64 {\n    const pages = &self.terminal.screens.active.pages;\n    const top_pin = pages.getTopLeft(.viewport);\n    return computeRowId(top_pin.node.serial, top_pin.y);\n}\n```\n\n## Files to Modify\n\n**Client:**\n- `client/src/terminal/connection.ts` — Send actual minRowId in sync\n\n**Server:**\n- `server/src/message_handlers.zig` — Pass minRowId to handler\n- `server/src/event_loop.zig` — Check staleness before delta\n- `server/src/pane.zig` — Add getMinVisibleRowId()\n\n## Trade-offs\n\n**Pros:**\n- Eliminates round-trip for resync request\n- Server can detect staleness even if client detection fails\n- Reduces corruption window\n\n**Cons:**\n- Doesn't handle style misses (only row misses)\n- minRowId alone doesn't catch \"holes\" in cache (missing middle rows)\n- Slightly more complex server logic\n\n## Dependencies\n\n- Should implement after: du-1i5 (resync message as fallback)\n- Independent of: du-353 (LRU pruning)\n\n## Reference\n\nDesign doc: `docs/cache-miss-resync-design.md` (Phase 3)","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-26T20:09:42.563670232Z","created_by":"rko","updated_at":"2026-01-26T20:24:24.299391319Z","closed_at":"2026-01-26T20:24:24.299378876Z","close_reason":"Implemented server-side cache staleness detection using minRowId. Server now checks if client's oldest cached row is newer than viewport minimum, and sends full snapshot proactively if cache is stale.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-2g3","depends_on_id":"du-1i5","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-2gt","title":"Implement cursor-style-blink option","description":"Enable/disable cursor blinking.\nOptions: cursor-style-blink = false | true\nDifficulty: Simple - toggle CSS animation","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:55.687837411Z","created_by":"rko","updated_at":"2025-12-30T17:34:53.113256Z","closed_at":"2025-12-30T17:34:53.113256Z","close_reason":"Implemented cursor-style-blink with dropdown: (auto) = blink by default, true = always blink, false = never blink. CSS animation via cursor-blink class.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-2gt","depends_on_id":"du-5mp","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-2gt","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-2um","title":"Migrate remaining client files to category logging","description":"Migrate remaining client files to use category-based debug logging.\n\n## Files to migrate\n\n### mouse.ts (9 calls) → category: mouse\nAlready has one `[mouse]` prefix, make it consistent.\n\n### keybindConfig.ts (8 calls) → category: keybind\nKeybind parsing errors and warnings.\n\n### store.ts (13 calls) → categories: clipboard, store\n- Clipboard operations → clipboard\n- State sync operations → store\n\n### clipboard.ts (4 calls) → category: clipboard\nClipboard read/write operations.\n\n### config.ts (2 calls) → category: config\nConfiguration save/load operations.\n\n### TerminalView.tsx (1 call) → category: ime\nIME initialization error.\n\n### ErrorBoundary.tsx (2 calls) → category: error\nReact error boundary - note: errors should always log regardless of category.\n\n## Pattern to follow\n```typescript\nimport { debug } from '../debug';\nconst log = debug.category('mouse');\n\n// Then use throughout file\nlog.log('click at', x, y);\nlog.warn('unexpected state');\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-25T06:02:08.781788088Z","created_by":"rko","updated_at":"2026-01-25T06:40:45.110505087Z","closed_at":"2026-01-25T06:40:45.110494799Z","close_reason":"Migrated all client files to category logging","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-2y6","title":"Implement DECRQM responses for mode status queries","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T02:49:13.491576933Z","created_by":"rko","updated_at":"2026-01-30T03:06:12.892442209Z","closed_at":"2026-01-30T03:06:12.892429654Z","close_reason":"Done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-319","title":"Migrate connection.ts to category logging","description":"Migrate client/src/terminal/connection.ts to use category-based logging.\n\nThis file has 69 logging calls and is the most verbose. It should be split into multiple categories:\n\n## Categories to use\n- `connection` - WebSocket connect/disconnect, reconnection attempts\n- `sync` - Delta sync, generation tracking, cache management\n- `snapshot` - Receiving snapshots, pane state\n- `delta` - Delta updates, row operations\n- `resize` - Dimension changes, resize messages\n- `layout` - Layout messages, window/pane structure\n\n## Example migration\n```typescript\n// Before\ndebug.log('WebSocket connected');\n\n// After\nconst connLog = debug.category('connection');\nconnLog.log('WebSocket connected');\n\n// Or inline\ndebug.category('connection').log('WebSocket connected');\n```\n\n## Also fix 3 non-compliant console.log calls\n- Line 414: `console.log(\"[dullahan] Received message type:\", ...)`\n- Line 613: `console.log(\"[dullahan] Layout received:\", ...)`  \n- Line 619: `console.log(\"[dullahan]   Window layout: [...]\")`\n\nReplace these with proper category-based debug.log() calls.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T06:01:59.123234266Z","created_by":"rko","updated_at":"2026-01-25T06:28:53.827033253Z","closed_at":"2026-01-25T06:28:53.827022396Z","close_reason":"Migrated connection.ts to category logging","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-33r","title":"Add IPC command for runtime debug logging control","description":"Add IPC command to control server debug logging at runtime.\n\nCommands:\n- dullahan debug-log              # Show current config\n- dullahan debug-log +all,-delta  # Set config  \n- dullahan debug-log list         # List all categories\n- dullahan debug-log on clipboard # Enable single category\n- dullahan debug-log off delta    # Disable single category\n\nAlso support environment variable: DULLAHAN_DEBUG=+all,-keyboard\n\nDepends on Wine-style logging infrastructure being created first.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T07:00:08.873372873Z","created_by":"rko","updated_at":"2026-01-25T22:10:16.731508892Z","closed_at":"2026-01-25T22:10:16.731495791Z","close_reason":"Implemented in commit 8819165","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-33r","depends_on_id":"du-279","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-341","title":"Switch TLS backend to OpenSSL shared lib (Zig 0.15.2)","description":"Goal: remove tls.zig dependency (requires Zig 0.16) and implement TLS via system OpenSSL shared libs while staying on Zig 0.15.2.\n\nContext:\n- Current TLS wrapper uses ianic/tls.zig in server/src/tls_wrapper.zig and is pinned in server/build.zig.zon.\n- Zig 0.16-dev breaks Ghostty deps; Zig 0.15.2 is required today.\n\nScope/changes:\n- Update server/build.zig to link system libraries: addSystemLibrary(\"ssl\") and addSystemLibrary(\"crypto\"); ensure linkage applies to server exe/tests.\n- Remove tls.zig import wiring from build.zig / build.zig.zon (no file deletions).\n- Rewrite server/src/tls_wrapper.zig to use @cImport(\"openssl/ssl.h\", \"openssl/err.h\").\n  - TlsContext.init: SSL_library_init/OPENSSL_init_ssl (if needed), SSL_CTX_new(TLS_server_method), SSL_CTX_use_certificate_file, SSL_CTX_use_PrivateKey_file, SSL_CTX_check_private_key; return errors with ERR_get_error details.\n  - TlsContext.deinit: SSL_CTX_free.\n  - TlsContext.upgrade: create SSL*, SSL_set_fd, SSL_accept for handshake; set TCP_NODELAY (keep existing behavior).\n  - TlsConnection.read/write: call SSL_read/SSL_write; on <=0 map SSL_get_error: WANT_READ/WANT_WRITE -> error.WouldBlock; ZERO_RETURN -> return 0 (clean close); SYSCALL/SSL -> log ERR_get_error and return error.\n  - TlsConnection.hasPendingData: SSL_pending > 0.\n  - TlsConnection.close: SSL_shutdown (2-phase if needed), SSL_free; close underlying fd handled elsewhere.\n- Keep existing Stream union API and semantics so callers (http.zig, websocket.zig, event_loop.zig) remain unchanged.\n\nAcceptance:\n- zig version 0.15.2 builds `make server` without tls.zig dependency.\n- WSS/HTTPS works with --tls-cert/--tls-key; plain HTTP path unchanged.\n- Non-blocking I/O path still returns WouldBlock correctly; clean close returns 0 to preserve websocket close logic.\n- Add concise error logs in tls_wrapper for SSL_read/SSL_write failures.","notes":"Closed after implementing OpenSSL TLS backend. Summary:\n- Dropped tls.zig dependency (server/build.zig.zon) and removed module import; linked system libssl/libcrypto + libc for exe/tests (server/build.zig).\n- Rewrote server/src/tls_wrapper.zig to use OpenSSL: SSL_CTX_new(TLS_server_method), SSL_CTX_use_certificate_file/PrivateKey, SSL_CTX_check_private_key; SSL_new/SSL_set_fd/SSL_accept; SSL_read/SSL_write with error mapping; SSL_pending for hasPendingData; SSL_shutdown + SSL_free on close.\n- Added TLS error logging (rc/ssl_error + OpenSSL error stack).\n- Build validated: `make server` passes on Zig 0.15.2.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T22:39:17.732672359Z","created_by":"rko","updated_at":"2026-01-28T23:28:18.510359548Z","closed_at":"2026-01-28T23:28:18.510317313Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-353","title":"Implement LRU-style cache pruning for delta sync","description":"## Problem\n\nCurrent cache pruning (commit 92eec66) is naive — it removes rows not in the current viewport without considering access patterns. This causes unnecessary resync requests when users scroll back to recently-viewed content.\n\n## Current Behavior\n\n```typescript\n// Prunes any row not in current viewport\nconst viewportRowIdSet = new Set(rowIds);\nfor (const cachedId of paneState.rowCache.keys()) {\n  if (!viewportRowIdSet.has(cachedId) && paneState.rowCache.size > MAX_CACHED_ROWS) {\n    paneState.rowCache.delete(cachedId);\n  }\n}\n```\n\n## Proposed Enhancement\n\nUse LRU (Least Recently Used) eviction that considers:\n1. **Recency**: When was this row last accessed/displayed?\n2. **Proximity**: How close to current viewport?\n3. **Style dependencies**: Keep rows that reference rare styles\n\n### Data Structure Change\n\n```typescript\ninterface CachedRow {\n  cells: Cell[];\n  lastAccess: number;  // timestamp\n  styleIds: Set<number>;  // styles used by this row\n}\n\n// Replace Map<bigint, Cell[]> with:\nrowCache: Map<bigint, CachedRow>;\n```\n\n### Eviction Algorithm\n\n```typescript\nfunction pruneCache(paneState: PaneState, currentRowIds: bigint[]): void {\n  if (paneState.rowCache.size <= MAX_CACHED_ROWS) return;\n  \n  const now = Date.now();\n  const viewportSet = new Set(currentRowIds);\n  \n  // Score each cached row (lower = more likely to evict)\n  const scored: Array<[bigint, number]> = [];\n  for (const [rowId, cached] of paneState.rowCache) {\n    if (viewportSet.has(rowId)) continue; // Never evict viewport rows\n    \n    const ageMs = now - cached.lastAccess;\n    const score = ageMs; // Simple: older = lower score = evict first\n    scored.push([rowId, score]);\n  }\n  \n  // Sort by score descending (highest age first)\n  scored.sort((a, b) => b[1] - a[1]);\n  \n  // Evict oldest until under limit\n  const toEvict = paneState.rowCache.size - MAX_CACHED_ROWS;\n  for (let i = 0; i < toEvict && i < scored.length; i++) {\n    const [rowId] = scored[i];\n    paneState.rowCache.delete(rowId);\n    paneState.rowGraphemes.delete(rowId);\n    paneState.rowHyperlinks.delete(rowId);\n  }\n}\n```\n\n### Style-Aware Pruning\n\nWhen pruning rows, also update style reference counts:\n\n```typescript\n// Track which styles are used by cached rows\nstyleRefCount: Map<number, number>;\n\n// When caching a row:\nfor (const styleId of row.styleIds) {\n  styleRefCount.set(styleId, (styleRefCount.get(styleId) ?? 0) + 1);\n}\n\n// When evicting a row:\nfor (const styleId of cached.styleIds) {\n  const count = styleRefCount.get(styleId) ?? 1;\n  if (count <= 1) {\n    styleRefCount.delete(styleId);\n    // Can safely evict this style too\n  } else {\n    styleRefCount.set(styleId, count - 1);\n  }\n}\n```\n\n## Files to Modify\n\n- `client/src/terminal/connection.ts`:\n  - Update PaneState interface with CachedRow type\n  - Add lastAccess tracking when rows are accessed\n  - Replace simple pruning with LRU algorithm\n  - Add style reference counting\n\n## Acceptance Criteria\n\n1. Frequently accessed rows survive pruning longer\n2. Scrolling back to recent content hits cache (no resync)\n3. Style table stays in sync with cached rows\n4. Memory usage remains bounded\n\n## Dependencies\n\n- Depends on: du-1i5 (resync message) — LRU is an optimization, resync is the safety net\n\n## Reference\n\nDesign doc: `docs/cache-miss-resync-design.md` (Phase 2)","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-26T20:09:19.542815386Z","created_by":"rko","updated_at":"2026-01-26T20:18:05.790781455Z","closed_at":"2026-01-26T20:18:05.790770222Z","close_reason":"Implemented LRU-style cache pruning. Rows now track lastAccess timestamp, and eviction sorts by age (oldest first) instead of arbitrarily removing non-viewport rows.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-353","depends_on_id":"du-1i5","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-355","title":"Reply to XTVersion queries with terminal identification","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T02:49:18.295881378Z","created_by":"rko","updated_at":"2026-01-30T03:22:14.424933438Z","closed_at":"2026-01-30T03:22:14.424921323Z","close_reason":"Done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-3as","title":"Extract message handlers to message_handlers.zig","description":"## Overview\nExtract the massive `handleParsedMessage` function from `server/src/event_loop.zig` into a new file `server/src/message_handlers.zig`.\n\n## Why\nThe event_loop.zig file is ~2784 lines. The `handleParsedMessage` function alone is ~900 lines (lines 1849-2751) - a single switch statement handling all message types. This is the largest extraction.\n\n## What to Extract\nThe `handleParsedMessage` function handles these message types:\n- `.key` - keyboard input (~50 lines)\n- `.text` - text/paste input (~40 lines)\n- `.resize` - pane resize (~25 lines)\n- `.scroll` - viewport scroll (~5 lines)\n- `.ping` - keepalive (~5 lines)\n- `.sync` - delta sync request (~5 lines)\n- `.focus` - pane focus change (~25 lines)\n- `.hello` - client identification (~35 lines)\n- `.request_master` - master request (~15 lines)\n- `.new_window` - create window (~60 lines)\n- `.close_window` - close window (~30 lines)\n- `.close_pane` - close pane (~50 lines)\n- `.set_layout` - change layout (~80 lines)\n- `.swap_panes` - swap pane positions (~40 lines)\n- `.resize_layout` - resize layout percentages (~50 lines)\n- `.mouse` - mouse events (~200 lines) - LARGEST\n- `.select_all` - select all text (~20 lines)\n- `.clear_selection` - clear selection (~15 lines)\n- `.clipboard_response` - OSC 52 response (~30 lines)\n- `.clipboard_set` - clipboard update (~20 lines)\n- `.copy` - copy selection (~50 lines)\n- `.clipboard_paste` - paste to PTY (~50 lines)\n\n## Design: HandlerContext\nCreate a context struct that provides access to EventLoop state:\n\n```zig\npub const HandlerContext = struct {\n    allocator: std.mem.Allocator,\n    session: *Session,\n    layouts: *layout_db.LayoutDb,\n    clients: *std.ArrayListUnmanaged(ClientState),\n    master_id: ?[]const u8,\n    ipc_clipboard_c: *?[]const u8,\n    ipc_clipboard_p: *?[]const u8,\n    \n    // Callbacks for operations that need EventLoop\n    broadcastPaneUpdate: *const fn(*Pane) anyerror!void,\n    broadcastLayout: *const fn() anyerror!void,\n    setMaster: *const fn(?[]const u8) anyerror!void,\n    sendSnapshot: *const fn(*websocket.Connection, *Pane) anyerror!void,\n    // etc.\n    \n    pub fn isMaster(self: *HandlerContext, client_id: []const u8) bool\n    pub fn wsBroadcastAll(self: *HandlerContext, msg: []const u8) void\n};\n```\n\n## Implementation Steps\n1. Create `server/src/message_handlers.zig`\n2. Define `HandlerContext` struct\n3. Create individual handler functions:\n   ```zig\n   pub fn handleKey(ctx: *HandlerContext, client: *ClientState, msg: ParsedKeyEvent) !void\n   pub fn handleText(ctx: *HandlerContext, client: *ClientState, msg: ParsedText) !void\n   pub fn handleMouse(ctx: *HandlerContext, client: *ClientState, msg: ParsedMouse) !void\n   // ... one for each message type\n   ```\n4. Create main dispatch function:\n   ```zig\n   pub fn handleParsedMessage(ctx: *HandlerContext, msg: ParsedMessage, client: *ClientState) !void {\n       switch (msg) {\n           .key => |m| try handleKey(ctx, client, m),\n           .text => |m| try handleText(ctx, client, m),\n           // ...\n       }\n   }\n   ```\n5. In `event_loop.zig`:\n   - Create `HandlerContext` in `handleWsClient`\n   - Call `message_handlers.handleParsedMessage(ctx, msg, client)`\n6. Run `zig build` and `zig build test`\n\n## Dependencies\n- client_state.zig (ClientState)\n- messages.zig (ParsedMessage and all parsed types)\n- session.zig, pane.zig, window.zig\n- layout_db.zig, layout_helpers.zig\n- keyboard.zig, mouse.zig\n- snapshot.zig\n- websocket.zig\n\n## Acceptance Criteria\n- [ ] New file `server/src/message_handlers.zig` exists\n- [ ] All message types handled correctly\n- [ ] Mouse handling works (most complex handler)\n- [ ] Clipboard operations work\n- [ ] Window/pane management works\n- [ ] `zig build` succeeds\n- [ ] `zig build test` passes\n\n## Estimated Size\n~950 lines in new file (but well-organized into small functions)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T22:16:17.329599108Z","created_by":"rko","updated_at":"2026-01-25T22:52:51.522949226Z","closed_at":"2026-01-25T22:52:51.522911272Z","close_reason":"Extracted handleParsedMessage to message_handlers.zig","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-3as","depends_on_id":"du-2bx","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-3as","depends_on_id":"du-3cy","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-3cy","title":"Extract ClientState to client_state.zig","description":"## Overview\nExtract the `ClientState` struct from `server/src/event_loop.zig` into a new file `server/src/client_state.zig`.\n\n## Why\nThe event_loop.zig file is ~2784 lines and cannot be read in one pass (2000 line limit). This is the simplest extraction to start the refactoring.\n\n## What to Extract\nLines 145-222 of event_loop.zig contain the `ClientState` struct:\n\n```zig\npub const ClientState = struct {\n    ws: websocket.Connection,\n    pane_generations: std.AutoHashMap(u16, u64),\n    connected: bool = true,\n    allocator: std.mem.Allocator,\n    client_id: ?[]const u8 = null,\n    authenticated: bool = false,\n    auth_token: ?[]const u8 = null,\n\n    pub fn init(...) ClientState\n    pub fn deinit(self: *ClientState) void\n    pub fn setClientId(self: *ClientState, id: []const u8) !void\n    pub fn setAuthToken(self: *ClientState, token: []const u8) !void\n    pub fn shortId(self: *const ClientState) []const u8\n    pub fn getGeneration(self: *ClientState, pane_id: u16) u64\n    pub fn setGeneration(self: *ClientState, pane_id: u16, gen: u64) void\n};\n```\n\n## Implementation Steps\n1. Create `server/src/client_state.zig`\n2. Move `ClientState` struct and all its methods\n3. Add required imports: `std`, `websocket`\n4. Import and use `logRecoverable` from event_loop or inline the error handling\n5. In `event_loop.zig`, add: `const client_state = @import(\"client_state.zig\");`\n6. Replace `ClientState` with `client_state.ClientState`\n7. Run `zig build` to verify compilation\n8. Run `zig build test` to verify tests pass\n\n## Dependencies\n- websocket.zig (already exists)\n\n## Acceptance Criteria\n- [ ] New file `server/src/client_state.zig` exists\n- [ ] `ClientState` struct fully functional in new location\n- [ ] `event_loop.zig` imports and uses the extracted module\n- [ ] `zig build` succeeds\n- [ ] `zig build test` passes\n- [ ] No functionality changes (pure refactor)\n\n## Estimated Size\n~100 lines in new file","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T22:15:18.763228935Z","created_by":"rko","updated_at":"2026-01-25T22:21:46.152136394Z","closed_at":"2026-01-25T22:21:46.152125175Z","close_reason":"Extracted ClientState to server/src/client_state.zig. Build and tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-3no","title":"Handle resize gracefully during sync","description":"Terminal resize reflows content. Force full resync on resize for simplicity. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:39:58.635189Z","created_by":"rko","updated_at":"2026-01-01T16:34:16.314680Z","closed_at":"2026-01-01T16:34:16.314680Z","close_reason":"Implemented in commit 3d7028d","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-3pf","title":"Migrate server code to unified category logging","description":"Replace all existing logging patterns with the new category-based system.\n\nMigration targets:\n- event_loop.zig: 19 dlog calls, 19 log_config guards (heaviest user)\n- pane.zig: 5 dlog calls, 9 log_config guards\n- pane_registry.zig: 4 dlog calls, 5 log_config guards\n- window.zig: 2 dlog calls, 3 log_config guards\n- clipboard.zig: 2 dlog calls, 3 log_config guards\n- server.zig: 1 dlog call\n\nReplace patterns:\n- if (log_config.log_x) dlog.info(...) -> category_logger.info(...)\n- Appropriate std.log.scoped() calls -> category loggers\n\nTotal: 36 dlog calls + 39 log_config guards to migrate across 6 files.\n\nDepends on Wine-style logging infrastructure.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T07:00:09.791953708Z","created_by":"rko","updated_at":"2026-01-25T22:10:16.721609970Z","closed_at":"2026-01-25T22:10:16.721599678Z","close_reason":"Implemented in commit 8819165","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-3pf","depends_on_id":"du-279","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-3pw","title":"HTTP/WebSocket upgrade reads request only once","description":"Problem: acceptWebSocket reads a single 4KB chunk and parses immediately. If headers arrive split across TCP packets or exceed 4KB (cookies/proxies), parseRequest sees partial data and the connection is dropped. This shows up as intermittent WS connect failures over TLS/WAN.\\nEvidence: server/src/http.zig:485-506 reads once into 4KB buffer then parseRequest.\\nFix idea: read until \"\\r\\n\\r\\n\" (with max header size cap) before parsing; preserve any extra bytes for later use if needed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-28T05:50:06.468392272Z","created_by":"rko","updated_at":"2026-01-28T06:03:18.076412856Z","closed_at":"2026-01-28T06:03:18.076401220Z","close_reason":"HTTP upgrade now reads until CRLFCRLF with header cap","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-3ss","title":"Handle remaining terminal query responses","notes":"Added TODOs and warning logs to surface unimplemented query usage.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-30T17:12:18.183974544Z","created_by":"rko","updated_at":"2026-01-30T17:14:10.668408238Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-4ro","title":"Add sync request/response messages","description":"Implement sync request from client and delta/resync responses from server. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:32.321482Z","created_by":"rko","updated_at":"2026-01-01T16:01:34.415144Z","closed_at":"2026-01-01T16:01:34.415144Z","close_reason":"Implemented in commit d6b2d77","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-59c","title":"Implement shell-integration-features option","description":"Configure shell integration behavior.\nOptions: shell-integration-features=no-cursor\nThis controls what shell integration features are enabled.\nDifficulty: Complex - requires shell integration protocol support","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-30T05:43:18.970385126Z","created_by":"rko","updated_at":"2026-01-25T06:53:04.014624365Z","closed_at":"2026-01-25T06:53:04.014553238Z","close_reason":"Too complex for now; some parts already implemented, defer full implementation","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-59c","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-5bp","title":"Implement clipboard API for copy/paste","description":"Integrate browser Clipboard API for terminal copy/paste.\n\n**Copy:**\n```typescript\nasync function copyToClipboard(text: string): Promise<void> {\n  await navigator.clipboard.writeText(text);\n}\n```\n\n**Paste:**\n```typescript\nasync function pasteFromClipboard(): Promise<string> {\n  return navigator.clipboard.readText();\n}\n```\n\n**Considerations:**\n- Requires secure context (HTTPS or localhost)\n- User permission may be required for paste\n- Need selection tracking to know what to copy\n- Paste should send text to PTY via 'text' message\n\n**Depends on:**\n- Selection tracking (not yet implemented)\n- Action handlers (du-9vm)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:49:19.024467Z","created_by":"rko","updated_at":"2026-01-25T06:47:08.329002040Z","closed_at":"2026-01-25T06:47:08.328987410Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-5bp","depends_on_id":"du-9vm","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-5mp","title":"Implement cursor-style config option","description":"Allow configuring cursor shape.\nOptions: cursor-style = block | bar | underline\nDifficulty: Simple - different CSS for each style","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:42:55.648062671Z","created_by":"rko","updated_at":"2025-12-30T17:16:11.446858Z","closed_at":"2025-12-30T17:16:11.446858Z","close_reason":"Implemented all 4 Ghostty cursor styles: block, bar, underline, block_hollow with CSS pseudo-elements","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-5mp","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-5zk","title":"Implement terminal title support (OSC 0/2)","description":"Add support for terminal window titles via OSC 0/2 escape sequences. Ghostty-vt already parses these; need to wire up Pane to track title, send via WebSocket, and display in client UI.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T20:32:10.938328Z","created_by":"rko","updated_at":"2026-01-03T20:39:12.320209Z","closed_at":"2026-01-03T20:39:12.320209Z","close_reason":"Implemented terminal title support via OSC 0/2 parsing","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-73i","title":"Create keybind string parser","description":"Parse Ghostty-style keybind strings into structured data.\n\n**Input formats:**\n```\nctrl+shift+c\nalt+enter\nsuper+k\nshift+page_up\nf1\nctrl+alt+delete\n```\n\n**Output:**\n```typescript\ninterface Keybind {\n  key: string;        // 'c', 'enter', 'page_up', 'f1'\n  ctrl: boolean;\n  alt: boolean;\n  shift: boolean;\n  meta: boolean;      // super/cmd\n}\n\nfunction parseKeybind(str: string): Keybind;\nfunction matchesKeybind(event: KeyboardEvent, keybind: Keybind): boolean;\n```\n\n**Key name mappings:**\n- `super` / `cmd` → meta\n- `page_up` → PageUp\n- `enter` → Enter\n- etc.\n\nNo dependencies - pure parsing logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:49:29.215453Z","created_by":"rko","updated_at":"2026-01-25T06:47:03.642455117Z","closed_at":"2026-01-25T06:47:03.642446055Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-7jz","title":"Delta Sync Phase 4: Polish","description":"Polish delta sync UX and add monitoring. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-01T15:39:04.338323Z","created_by":"rko","updated_at":"2026-01-01T16:34:43.204976Z","closed_at":"2026-01-01T16:34:43.204976Z","close_reason":"Phase 4 complete - core tasks done, UX polish and metrics deferred","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-7jz","depends_on_id":"du-1m3","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-7jz","depends_on_id":"du-3no","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-7jz","depends_on_id":"du-94f","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-7jz","depends_on_id":"du-anh","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-7jz","depends_on_id":"du-s7v","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-7oc","title":"Implement Wine-style category debug logging","description":"Implement a Wine-style debug logging system for the client where logging belongs to categories that can be individually enabled/disabled.\n\n## Syntax\n- URL: `?debug=+all,-mouse,+pane`\n- localStorage: same format stored as `debug` key\n\n## Behavior\n- `+category` enables a category\n- `-category` disables a category  \n- `+all` enables all categories\n- `-all` disables all categories\n- Categories evaluated left-to-right, so `+all,-mouse` enables everything except mouse\n- Bare `?debug` (no value) defaults to `+all` for backward compatibility\n\n## Categories (based on current logging patterns)\n- connection - WebSocket connection, reconnection\n- sync - Delta sync, generation tracking\n- snapshot - Terminal state snapshots\n- delta - Delta updates\n- mouse - Mouse events\n- keyboard - Keyboard input\n- keybind - Keybind parsing/matching\n- clipboard - Clipboard operations\n- config - Configuration\n- ime - IME composition\n- resize - Terminal resizing\n- layout - Layout messages, window/pane structure\n- store - State store operations\n- all - Special: matches all categories\n\n## Reference\nWine's WINEDEBUG: https://wiki.winehq.org/Debug_Channels","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-25T06:01:37.885332295Z","created_by":"rko","updated_at":"2026-01-25T06:41:20.414854166Z","closed_at":"2026-01-25T06:41:20.414843787Z","close_reason":"All implementation tasks completed: debug.ts rewrite, connection.ts migration, remaining files migration","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-7yb","title":"Implement adjust-cell-width/height options","description":"Fine-tune cell dimensions.\nOptions: adjust-cell-width = -1, adjust-cell-height = -2\nDifficulty: Medium - need to calculate and apply to cell sizing","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:44.775845823Z","created_by":"rko","updated_at":"2025-12-30T17:44:30.707946Z","closed_at":"2025-12-30T17:44:30.707946Z","close_reason":"Deferred - cell width not feasible in DOM, needs Canvas renderer. Cell height can use line-height but not exact. Implementing lineHeight setting separately.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-7yb","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-896","title":"Implement cursor-color config option","description":"Allow configuring cursor color.\nOptions: cursor-color = #aaff00\nAlready have --term-cursor-bg, just need config UI.\nDifficulty: Simple","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:42:55.657697413Z","created_by":"rko","updated_at":"2025-12-30T17:25:13.865621Z","closed_at":"2025-12-30T17:25:13.865621Z","close_reason":"Implemented cursor-color with theme default, cell-foreground, cell-background options","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-896","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-8ek","title":"Consider std.json.stringify for snapshot.zig","description":"Evaluate using std.json.stringify for JSON generation in snapshot.zig.\n\n**Current approach:**\n- Manual string formatting with std.fmt.format\n- Manual JSON escaping for binary data (base64)\n\n**Considerations:**\n- May need to keep manual control for base64-encoded binary fields (cells, styles)\n- std.json.stringify is cleaner for simple fields (width, height, cursor_x, etc.)\n- Could use hybrid approach: stringify for metadata, manual for binary blobs\n\n**Lower priority** - current approach works and is reasonably clean.\nThe main benefit would be consistency with ws_server.zig refactor.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-31T17:33:26.279864Z","created_by":"rko","updated_at":"2025-12-31T17:40:31.468608Z","closed_at":"2025-12-31T17:40:31.468608Z","close_reason":"Implemented in commit 5b5536d","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-94f","title":"Viewport pruned UX improvement","description":"When user's viewport is pruned from history, show indicator or smoothly transition instead of jumping. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:40:03.713404Z","created_by":"rko","updated_at":"2026-01-01T16:34:28.823238Z","closed_at":"2026-01-01T16:34:28.823238Z","close_reason":"Deferred - UX nicety, not critical for delta sync. Basic behavior (jump to valid viewport) works.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-9ej","title":"Add keybind interception to keyboard handler","description":"Modify KeyboardHandler to check keybinds before sending to server.\n\n**Current flow:**\n```\nKeyboardEvent → KeyboardHandler → WebSocket → Server → PTY\n```\n\n**New flow:**\n```\nKeyboardEvent → KeyboardHandler → check keybinds\n  ├─ match? → execute action (don't send to server)\n  └─ no match? → WebSocket → Server → PTY\n```\n\n**Implementation:**\n```typescript\nclass KeyboardHandler {\n  private keybinds: Map<string, TerminalAction>;\n  \n  setKeybinds(bindings: Array<{keybind: Keybind, action: TerminalAction}>): void;\n  \n  private handleKeyDown(e: KeyboardEvent): void {\n    const action = this.matchKeybind(e);\n    if (action) {\n      e.preventDefault();\n      this.executeAction(action);\n    } else {\n      this.sendToServer(e);\n    }\n  }\n}\n```\n\n**Depends on:**\n- du-9vm (action types)\n- du-73i (keybind parser)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:49:38.595317Z","created_by":"rko","updated_at":"2026-01-25T06:47:08.316502542Z","closed_at":"2026-01-25T06:47:08.316492053Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-9ej","depends_on_id":"du-73i","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-9ej","depends_on_id":"du-9vm","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-9vm","title":"Define terminal action types and handlers","description":"Create the action system for terminal keybinds.\n\n**Actions to support:**\n- `copy_to_clipboard` - copy selection to clipboard\n- `paste_from_clipboard` - paste from clipboard\n- `scroll_page_up` / `scroll_page_down`\n- `scroll_to_top` / `scroll_to_bottom`\n- `clear_screen`\n- `reset_terminal`\n- `new_tab` / `close_tab` (future)\n- `text:...` - send literal text\n\n**Implementation:**\n```typescript\ntype TerminalAction = \n  | { type: 'copy_to_clipboard' }\n  | { type: 'paste_from_clipboard' }\n  | { type: 'scroll', direction: 'up' | 'down', amount: 'page' | 'line' }\n  | { type: 'send_text', text: string }\n  // ...\n\ntype ActionHandler = (action: TerminalAction, terminal: Terminal) => void;\n```\n\nNo external dependencies - just types and handler signatures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:49:10.087194Z","created_by":"rko","updated_at":"2026-01-25T06:47:03.653032158Z","closed_at":"2026-01-25T06:47:03.653022798Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-9yo","title":"Send terminal resize to server when dimensions change","description":"When client calculates new terminal dimensions (via useTerminalDimensions hook), send resize message to server so it can resize the PTY.\n\nLocation: client/src/components/App.tsx in handleDimensionsChange callback\n\nRequires:\n- WebSocket message type for resize (cols, rows)\n- Server handler to resize PTY (ioctl TIOCSWINSZ)\n- Debounce on client to avoid flooding during drag resize","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T17:47:18.286955Z","created_by":"rko","updated_at":"2025-12-31T20:02:36.837177Z","closed_at":"2025-12-31T20:02:36.837177Z","close_reason":"Implemented resize message from client to server with 100ms debounce. Server already had handler - just needed to wire up client handleDimensionsChange callback to call connection.sendResize().","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-af0","title":"Add generation counter to server state","description":"Add monotonic generation counter that increments on any terminal change. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:18.166160Z","created_by":"rko","updated_at":"2026-01-01T15:49:34.356906Z","closed_at":"2026-01-01T15:49:34.356906Z","close_reason":"Implemented in commit 17af39a","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-anh","title":"Debug mode: delta/resync counters in title bar","description":"Show sync stats in title: 'Dullahan - [Δ 1,234 | ⟳ 2]' for delta count and resync count. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:40:09.521677Z","created_by":"rko","updated_at":"2026-01-01T16:32:44.953887Z","closed_at":"2026-01-01T16:32:44.953887Z","close_reason":"Already implemented in commit 2a94b65 - sync stats display shows Δ{deltas} ⟳{resyncs} in titlebar","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-at5","title":"Implement cursor-text config option","description":"Text color when cursor is over a character.\nOptions: cursor-text = #000000\nAlready have --term-cursor-fg, just need config.\nDifficulty: Simple","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:55.667687270Z","created_by":"rko","updated_at":"2025-12-30T17:25:13.888680Z","closed_at":"2025-12-30T17:25:13.888680Z","close_reason":"Implemented cursor-text with theme default, cell-foreground, cell-background options (applies to block cursor)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-at5","depends_on_id":"du-5mp","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-at5","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-aud","title":"IME support for CJK input","description":"Add Input Method Editor support for Chinese/Japanese/Korean text input.\n\nRequires hidden textarea approach - see docs/ime-support.md for implementation notes.\n\nKey points:\n- Hidden textarea with opacity:0 (not display:none)\n- CompositionEvent API (compositionstart/update/end)\n- Position near cursor for IME popup\n- Also enables mobile virtual keyboard support","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-30T07:07:32.321330119Z","created_by":"rko","updated_at":"2026-01-25T06:47:03.667397427Z","closed_at":"2026-01-25T06:47:03.667381664Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-b0n","title":"Implement font-feature config option","description":"Enable OpenType font features.\nOptions: font-feature=+NWID (natural width), +ss01, etc.\nDifficulty: Medium - use font-feature-settings CSS property","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:44.765546733Z","created_by":"rko","updated_at":"2025-12-30T16:27:05.280835Z","closed_at":"2025-12-30T16:27:05.280835Z","close_reason":"Implemented - fontFeature config with text input in Settings, applies to font-feature-settings CSS property","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-b0n","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-b0n","depends_on_id":"du-z07","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-ckn","title":"Typecheck fails in LayoutRenderer.tsx (LayoutNode undefined)","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-03T22:09:30.758197470Z","created_by":"rko","updated_at":"2026-02-03T22:09:30.758197470Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-csm","title":"Implement cursor-opacity config option","description":"Cursor transparency.\nOptions: cursor-opacity = 1.0 (0.0 to 1.0)\nDifficulty: Simple - CSS opacity property","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:55.677729273Z","created_by":"rko","updated_at":"2025-12-30T17:30:10.575511Z","closed_at":"2025-12-30T17:30:10.575511Z","close_reason":"Implemented cursor-opacity with number input (0.0-1.0), applies to all cursor styles via --term-cursor-opacity CSS variable","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-csm","depends_on_id":"du-5mp","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-csm","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-cu7","title":"Final cleanup of event_loop.zig after extractions","description":"## Overview\nAfter all extractions are complete, clean up `server/src/event_loop.zig` to be a lean orchestration module.\n\n## Why\nThis is the final step of the event_loop.zig refactoring. After extracting ClientState, layout helpers, message parsing, and message handlers, the remaining file should be ~800 lines focused on core event loop orchestration.\n\n## What Should Remain in event_loop.zig\n\n### Imports (~50 lines)\n- Standard library\n- All server modules including new extracted ones\n- Scoped loggers\n\n### Error Helpers (~20 lines)\n- `logRecoverable`, `logClientError`, `logFatal`\n- (Consider: move to a shared `errors.zig`?)\n\n### EventLoop Struct (~750 lines)\nFields:\n- allocator, ipc_server, http_server, session\n- clients list\n- running flag\n- start_time, commands_processed\n- master_id, master_theme_fg, master_theme_bg\n- layouts (LayoutDb)\n- ipc_clipboard_c, ipc_clipboard_p\n- no_delta flag\n\nCore Methods:\n- `init()`, `deinit()`, `uptime()`\n- `run()`, `stop()` - main loop\n- `buildPollSet()` - construct poll fd array\n- `dispatchEvents()` - route poll results\n- `handleIpc()` - IPC command handling\n- `handleHttpAccept()` - new WebSocket connections\n- `handleWsClient()` - WebSocket frame handling (delegates to message_handlers)\n- `handlePtyData()` - PTY output handling\n- `checkSyncTimeouts()` - sync mode timeout check\n\nClient Management:\n- `removeClient()`, `getClientById()`, `getIdentifiedClientCount()`\n\nMaster/Slave:\n- `isMaster()`, `setMaster()`, `broadcastMasterChanged()`\n- `setMasterTheme()`, `updatePaneThemeColors()`\n\nBroadcasting:\n- `wsBroadcastAll()`, `wsBroadcast()`, `wsSendUnchecked()`, `wsSendToMaster()`\n- `broadcastLayout()`, `broadcastPaneUpdate()`\n- `sendClientUpdates()`, `sendPaneUpdate()`, `sendSnapshot()`\n\nClipboard:\n- `sendIpcClipboardState()`, `updateIpcClipboardFromBase64()`\n- `updatePrimaryClipboardFromSelection()`, `handlePaneClipboard()`\n\nShell Integration:\n- `handlePaneShellIntegration()`\n\nSync:\n- `handleSyncRequest()`\n\n## Implementation Steps\n1. Verify all extractions are complete and working\n2. Remove any dead code or unused imports\n3. Reorganize remaining code into logical sections with clear comments\n4. Ensure all delegations to extracted modules work correctly\n5. Consider further small extractions if any section is still too large\n6. Update file header comment to reflect new scope\n7. Run `zig build` and `zig build test`\n8. Run full integration test (start server, connect client, test all features)\n\n## Verification Checklist\n- [ ] File is under 1000 lines\n- [ ] All imports are used\n- [ ] No duplicate code with extracted modules\n- [ ] Clear section comments\n- [ ] `zig build` succeeds\n- [ ] `zig build test` passes\n- [ ] Manual integration test passes:\n  - [ ] Server starts\n  - [ ] Client connects\n  - [ ] Keyboard input works\n  - [ ] Mouse selection works\n  - [ ] Clipboard works\n  - [ ] Window creation works\n  - [ ] Layout switching works\n  - [ ] Multiple clients work (master/slave)\n\n## Final File Structure\n```\nserver/src/\n├── event_loop.zig       # ~800 lines - orchestration\n├── client_state.zig     # ~100 lines - client state\n├── message_parsing.zig  # ~450 lines - protocol parsing\n├── message_handlers.zig # ~950 lines - message dispatch\n├── layout_helpers.zig   # ~200 lines - layout utilities\n└── (other existing files unchanged)\n```\n\n## Estimated Size\n~800 lines remaining in event_loop.zig","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-25T22:16:44.814367022Z","created_by":"rko","updated_at":"2026-01-25T23:36:17.266002817Z","closed_at":"2026-01-25T23:36:17.265973572Z","close_reason":"Completed: event_loop.zig reduced to 992 lines (under 1000 target)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-cu7","depends_on_id":"du-2bx","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-cu7","depends_on_id":"du-2ci","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-cu7","depends_on_id":"du-3as","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-cu7","depends_on_id":"du-3cy","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-d4e","title":"Add IPC command for sending terminal input","description":"Add an IPC command to send input to the active pane's PTY.\n\nCurrent IPC system only supports enum commands without parameters.\nNeed to either:\n1. Extend IPC protocol to support parameterized commands\n2. Add a separate data channel for input\n\nUse case: scripting/automation, piping data to terminal from CLI","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T21:50:54.054368Z","created_by":"rko","updated_at":"2026-01-25T06:49:10.902151287Z","closed_at":"2026-01-25T06:49:10.902088069Z","close_reason":"Implemented: send <pane_id> [text] command in ipc_commands.zig","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-di2","title":"Implement client-side config system","description":"Create a configuration system for the client.\n- Parse config options (from URL params, localStorage, or config file)\n- Apply config to CSS variables and component state\n- Provide API for components to read config\nDifficulty: Medium - foundation for all other config options","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-30T05:43:18.960297918Z","created_by":"rko","updated_at":"2025-12-30T06:02:32.383430670Z","closed_at":"2025-12-30T06:02:32.383430670Z","close_reason":"Implemented client-side config system with localStorage persistence, get(key, fallback) pattern, and liquid glass settings modal","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-gbq","title":"Delta Sync Phase 1: Foundation","description":"Foundation work for delta sync protocol. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-01T15:38:47.459457Z","created_by":"rko","updated_at":"2026-01-01T15:49:55.392458Z","closed_at":"2026-01-01T15:49:55.392458Z","close_reason":"All Phase 1 tasks complete (du-pq1, du-y9r, du-af0)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-gbq","depends_on_id":"du-af0","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-gbq","depends_on_id":"du-pq1","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-gbq","depends_on_id":"du-y9r","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-iam","title":"Client-side scrollback buffer","description":"Implement scrollback on the client side.\n\n**Approach:** Client maintains a ring buffer of terminal rows. As snapshots arrive, accumulate history rather than replacing it entirely.\n\n**Data structure:**\n```typescript\ninterface ScrollbackBuffer {\n  rows: CellRow[];           // Ring buffer of rows\n  maxRows: number;           // Max history (e.g., 10000)\n  viewportTop: number;       // Which row is at top of viewport\n  activeStart: number;       // Where the 'active' area begins\n}\n```\n\n**Behavior:**\n- New output appends to buffer (up to maxRows)\n- Viewport can scroll within buffer\n- When at bottom, new output auto-scrolls\n- When scrolled up, new output doesn't move viewport\n\n**UI:**\n- Mouse wheel scrolls viewport\n- Shift+PageUp/PageDown for keyboard scrolling\n- Scrollbar indicator (optional, later)\n\n**Changes needed:**\n- App.tsx: Add scrollback state\n- Render rows from buffer based on viewport position\n- Handle wheel events","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T18:00:16.235911Z","created_by":"rko","updated_at":"2025-12-31T18:06:18.590468Z","closed_at":"2025-12-31T18:06:18.590468Z","close_reason":"Implemented in commit 0a015e9","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-ij9","title":"Implement DECSCUSR (CSI q) cursor style escape sequence","description":"Support DECSCUSR (CSI q) escape sequences for programs to dynamically change cursor style.\n\nWhen a program sends CSI q sequences, the cursor style should change accordingly:\n- CSI 0 q / CSI 1 q: blinking block\n- CSI 2 q: steady block\n- CSI 3 q: blinking underline\n- CSI 4 q: steady underline\n- CSI 5 q: blinking bar\n- CSI 6 q: steady bar\n\nRequires:\n- Server to capture cursor style from ghostty-vt terminal state\n- Server to send cursor style in snapshots/deltas\n- Protocol to include cursor style field\n- Client to render dynamic cursor style (currently only uses config setting)\n\nNote: DEC Mode 12 (cursor blink) is already implemented. This is specifically for cursor shape/style changes.","status":"deferred","priority":3,"issue_type":"feature","created_at":"2026-01-25T06:53:39.902538655Z","created_by":"rko","updated_at":"2026-01-25T22:19:52.473300947Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-ipx","title":"Upgrade dirty tracking to per-generation sets","description":"If Option C proves insufficient, upgrade to Option A (per-generation dirty sets) for more precise deltas. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:39:52.425049Z","created_by":"rko","updated_at":"2026-01-01T16:32:14.871478Z","closed_at":"2026-01-01T16:32:14.871478Z","close_reason":"Deferred - Option C (simple dirty set) is sufficient for current needs. Will implement if sync efficiency becomes an issue.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-kqi","title":"Implement window-width/height options","description":"Set default terminal dimensions in columns/rows.\nOptions: window-width = 180, window-height = 45\nDifficulty: Medium - need to communicate desired size to server","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:43:08.893934047Z","created_by":"rko","updated_at":"2025-12-30T16:41:31.543568Z","closed_at":"2025-12-30T16:41:31.543568Z","close_reason":"Deferred - window dimensions require server coordination, not just client config","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-kqi","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-lpl","title":"Implement font-size config option","description":"Allow configuring font size.\nOptions: font-size = 10 (in points or pixels)\nDifficulty: Simple - set --term-font-size CSS variable","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:42:44.745668763Z","created_by":"rko","updated_at":"2025-12-30T16:24:32.579467Z","closed_at":"2025-12-30T16:24:32.579467Z","close_reason":"Already implemented - fontSize in config with Settings UI and --term-font-size CSS variable","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-lpl","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-lvb","title":"Implement dirty row tracking","description":"Track which rows changed since last sync using Option C (simple dirty set + watermark). See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:27.495212Z","created_by":"rko","updated_at":"2026-01-01T15:55:53.221411Z","closed_at":"2026-01-01T15:55:53.221411Z","close_reason":"Implemented in commit 62b1d3e","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-mb2","title":"Implement font-style config option","description":"Allow configuring font weight/style.\nOptions: font-style = Medium, Bold, Light, etc.\nDifficulty: Simple - set font-weight CSS property","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:42:44.756054096Z","created_by":"rko","updated_at":"2025-12-30T16:27:00.085187Z","closed_at":"2025-12-30T16:27:00.085187Z","close_reason":"Implemented - fontStyle config with Font Weight dropdown in Settings, applies to --term-font-weight CSS variable","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-mb2","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-mb2","depends_on_id":"du-z07","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-msr","title":"Viewport-priority sending","description":"Send visible viewport rows first, then off-screen changes. Improves perceived latency. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:39:41.725419Z","created_by":"rko","updated_at":"2026-01-01T16:32:01.644127Z","closed_at":"2026-01-01T16:32:01.644127Z","close_reason":"Implemented in commit fffd8bb","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-mw6","title":"Implement bell visual attention","description":"Visual feedback when terminal bell triggers.\nOptions: bell-features=attention (flash screen)\nDifficulty: Simple - CSS animation on bell event","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:43:08.864513885Z","created_by":"rko","updated_at":"2026-01-04T00:21:59.159298Z","closed_at":"2026-01-04T00:21:59.159298Z","close_reason":"Implemented bell features: title prefix (🔔), visual attention animation (CSS color reverse), and audio (Web Audio sine wave). Configurable via bellFeatures setting.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-mw6","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-n6h","title":"Implement keybind configuration system","description":"Integration issue: Wire up keybind configuration from config file.\n\nThis is the final step that connects config loading with the keybind system.\n\n**Subtasks (do these first):**\n- du-9vm: Define terminal action types\n- du-73i: Create keybind string parser  \n- du-5bp: Implement clipboard API\n- du-9ej: Add keybind interception to keyboard handler\n- du-di2: Client-side config system\n\n**This issue:**\n- Parse `keybind = ctrl+shift+c=copy_to_clipboard` from config\n- Register keybinds with KeyboardHandler on startup\n- Support reload on config change","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:43:18.949455733Z","created_by":"rko","updated_at":"2026-01-25T06:47:08.334215803Z","closed_at":"2026-01-25T06:47:08.334196100Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-n6h","depends_on_id":"du-5bp","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-n6h","depends_on_id":"du-9ej","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"du-n6h","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-n76","title":"Respond to kitty keyboard protocol queries","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T02:49:21.498054381Z","created_by":"rko","updated_at":"2026-01-30T03:24:06.675822489Z","closed_at":"2026-01-30T03:24:06.675810426Z","close_reason":"Done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-pq1","title":"Add row_id computation to snapshot.zig","description":"Compute stable row IDs using (page_serial * 1000) + row_index. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:13.871226Z","created_by":"rko","updated_at":"2026-01-01T15:47:22.516875Z","closed_at":"2026-01-01T15:47:22.516875Z","close_reason":"Implemented in commit 5ef3b86","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-pxn","title":"Client delta application logic","description":"Implement client-side logic to apply delta updates: prune old rows, apply changes, update generation. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:36.700666Z","created_by":"rko","updated_at":"2026-01-01T16:03:18.661768Z","closed_at":"2026-01-01T16:03:18.661768Z","close_reason":"Implemented in commit 6906f58","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-q0f","title":"Client WS send lacks backpressure (bufferedAmount)","description":"Problem: client always ws.send(JSON.stringify(msg)) with no backpressure. On slow links this queues unbounded data in the browser, which can add latency spikes and GC pressure.\\nEvidence: client/src/terminal/connection.ts:1388-1391 uses ws.send without checking ws.bufferedAmount or coalescing.\\nFix idea: gate sends when bufferedAmount exceeds a threshold; coalesce high-frequency messages (mouse/scroll/resize) or drop if over budget; optionally expose metrics to UI/debug.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T05:50:10.815169494Z","created_by":"rko","updated_at":"2026-01-28T06:03:20.823057966Z","closed_at":"2026-01-28T06:03:20.823046161Z","close_reason":"Client outbound queue + bufferedAmount backpressure","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-q9o","title":"Implement selection-clear-on-copy option","description":"Clear text selection after copying to clipboard.\nOptions: selection-clear-on-copy=true\nDifficulty: Simple - window.getSelection().removeAllRanges()","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:43:08.883979165Z","created_by":"rko","updated_at":"2026-01-25T06:47:03.658182265Z","closed_at":"2026-01-25T06:47:03.658173516Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-q9o","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-qz8","title":"Document category debug logging system","description":"Update documentation for the new Wine-style category debug logging system.\n\n## Update AGENTS.md\n\nReplace the \"Client Debug Logging\" section with:\n\n```markdown\n### Client Debug Logging\n\nWine-style category-based logging. Enable specific categories via URL or localStorage.\n\n**Syntax:** `?debug=+all,-mouse,+pane` or `localStorage.setItem('debug', '+all,-mouse')`\n\n**Rules:**\n- `+category` enables a category\n- `-category` disables a category\n- `+all` / `-all` enables/disables all categories\n- Evaluated left-to-right: `+all,-mouse` = everything except mouse\n- Bare `?debug` defaults to `+all` for backward compatibility\n\n**Categories:**\n| Category | Description |\n|----------|-------------|\n| connection | WebSocket connect/disconnect |\n| sync | Delta sync, generation tracking |\n| snapshot | Terminal state snapshots |\n| delta | Delta updates |\n| mouse | Mouse events |\n| keyboard | Keyboard input |\n| keybind | Keybind parsing |\n| clipboard | Clipboard operations |\n| config | Configuration |\n| ime | IME composition |\n| resize | Terminal resizing |\n| layout | Layout messages |\n| store | State store operations |\n\n**Examples:**\n```bash\n# Enable all logging\nhttp://localhost:7681/?debug\n\n# Only mouse and keyboard\nhttp://localhost:7681/?debug=+mouse,+keyboard\n\n# Everything except verbose sync/delta\nhttp://localhost:7681/?debug=+all,-sync,-delta\n```\n\n**Usage in code:**\n```typescript\nimport { debug } from '../debug';\nconst log = debug.category('mouse');\n\nlog.log('click at', x, y);\nlog.warn('unexpected state');\nlog.error('failed'); // Always logs regardless of category\n```\n```\n\n## Add startup help message\n\nWhen debug is enabled, log available categories to console:\n```\n[dullahan] Debug categories: connection, sync, snapshot, delta, mouse, keyboard, keybind, clipboard, config, ime, resize, layout, store\n[dullahan] Current config: +all,-mouse\n[dullahan] Change via: ?debug=+all,-mouse or localStorage.setItem('debug', '+all,-mouse')\n```","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-01-25T06:02:20.106072383Z","created_by":"rko","updated_at":"2026-01-25T06:42:03.307962610Z","closed_at":"2026-01-25T06:42:03.307951401Z","close_reason":"Updated AGENTS.md with Wine-style category logging documentation","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-qz8","depends_on_id":"du-2ap","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-s7v","title":"Metrics/monitoring for sync efficiency","description":"Track and expose metrics: bytes/second, deltas/second, resync rate, average delta size. See docs/delta-sync-design.md","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-01T15:40:13.597444Z","created_by":"rko","updated_at":"2026-01-01T16:34:38.755049Z","closed_at":"2026-01-01T16:34:38.755049Z","close_reason":"Deferred - P3 task. Basic counters (deltaCount, resyncCount) already available in client. Full metrics can be added when needed.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-u3m","title":"Implement DEC Mode 12 (AT&T cursor blink) support","description":"When cursor-style-blink is set to auto (empty string), respect DEC Mode 12 escape sequences to toggle cursor blinking on/off.\n\nAlso support DECSCUSR (CSI q) for cursor style changes from running programs.\n\nReference: Ghostty docs state that with auto mode, DEC Mode 12 controls blinking, while explicit true/false ignores it but still respects DECSCUSR.\n\nRequires:\n- Server to parse and track DEC Mode 12 state\n- Server to send cursor blink state in snapshots\n- Client to use server state when config is auto","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-30T17:35:45.218989Z","created_by":"rko","updated_at":"2026-01-25T06:51:30.005169394Z","closed_at":"2026-01-25T06:51:30.005136026Z","close_reason":"DEC Mode 12 cursor blink implemented: server sends blink state, client auto mode respects it","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-up7","title":"Compression tuning for deltas","description":"Implement 256-byte threshold for snappy compression. Skip compression for tiny payloads. See docs/delta-sync-design.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T15:39:47.108489Z","created_by":"rko","updated_at":"2026-01-01T16:30:38.828342Z","closed_at":"2026-01-01T16:30:38.828342Z","close_reason":"Implemented in commit 19fca3d","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-uwc","title":"Implement bell title change","description":"Change page title on bell.\nOptions: bell-features=title\nDifficulty: Simple - document.title manipulation","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-30T05:43:08.874333906Z","created_by":"rko","updated_at":"2026-01-04T00:21:59.162651Z","closed_at":"2026-01-04T00:21:59.162651Z","close_reason":"Implemented bell features: title prefix (🔔), visual attention animation (CSS color reverse), and audio (Web Audio sine wave). Configurable via bellFeatures setting.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-uwc","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-x22","title":"WS read path drops partial frames with timeouts/TLS","description":"Problem: WebSocket read uses a single-pass read of header+payload with SO_RCVTIMEO (100ms) and no per-client buffer. If a frame arrives split (common over TLS/WAN), readFrame can time out mid-frame, and the event loop logs 'partial frame?' then discards already-read bytes. This desyncs framing and can cause hiccups or disconnects.\\nEvidence: server/src/websocket.zig:231-272 reads header+payload without buffering; server/src/event_loop.zig:315-323 treats timeout as partial frame and continues; server/src/event_loop.zig:483 sets 100ms timeouts.\\nFix idea: make sockets non-blocking; keep a per-client read buffer + state machine for frame parsing; only advance buffer on complete frames. Alternatively remove short RCVTIMEO for WS reads and rely on poll(); still need buffering for partial TCP reads.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-28T05:49:56.446609218Z","created_by":"rko","updated_at":"2026-01-28T06:03:10.060474871Z","closed_at":"2026-01-28T06:03:10.060459056Z","close_reason":"Implemented buffered WS read + non-blocking to avoid partial frame loss","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-y9r","title":"Send row_ids in snapshot","description":"Include row_ids in snapshot response as preparation for delta protocol. See docs/delta-sync-design.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T15:39:22.210385Z","created_by":"rko","updated_at":"2026-01-01T15:47:39.910686Z","closed_at":"2026-01-01T15:47:39.910686Z","close_reason":"Completed as part of du-pq1 (commit 5ef3b86)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"du-yv0","title":"Implement bell audio support","description":"Play audio when terminal bell is triggered.\nOptions: \n  bell-audio-path=~/bell.mp3\n  bell-audio-volume=1.0\n  bell-features=audio\nDifficulty: Medium - need Audio API, handle BEL character from server","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-30T05:43:08.854098884Z","created_by":"rko","updated_at":"2026-01-04T00:21:59.161602Z","closed_at":"2026-01-04T00:21:59.161602Z","close_reason":"Implemented bell features: title prefix (🔔), visual attention animation (CSS color reverse), and audio (Web Audio sine wave). Configurable via bellFeatures setting.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-yv0","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-z07","title":"Implement font-family config option","description":"Allow configuring the terminal font family via CSS variable or config.\nOptions: font-family = Iosevka, Aporetic Sans Mono, etc.\nDifficulty: Simple - just set --term-font CSS variable","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:42:44.735648179Z","created_by":"rko","updated_at":"2025-12-30T16:24:35.917170Z","closed_at":"2025-12-30T16:24:35.917170Z","close_reason":"Already implemented - fontFamily in config with Settings UI and --term-font CSS variable","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"du-z07","depends_on_id":"du-di2","type":"blocks","created_at":"2026-01-29T00:00:31Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"du-zii","title":"Fix memory leak in IPC command handler","description":"In server.zig handleCommand(), the status and help commands allocate response data that is never freed. The TODO on line 88 notes this: 'Note: This leaks, but server is long-running so it's fine for now'.\n\nFix: Use an arena allocator per-request that gets freed after sendResponse().","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-27T19:16:02.488425Z","created_by":"rko","updated_at":"2026-01-25T06:47:03.662790902Z","closed_at":"2026-01-25T06:47:03.662774293Z","close_reason":"Already implemented","source_repo":".","compaction_level":0,"original_size":0}
